<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="jquery-3.6.0.js"></script>
    <script src="bootstrap-5.0.0-beta2-dist/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="bootstrap-5.0.0-beta2-dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="gamespace.css" />
    <title>Zombie Killing</title>
</head>
<body>
    <div id="text"></div>
    <div id="myModal" class="modal">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <p class="modal-title">
                        Bienvenu dans ce petit programme de jeu Zombie Killing
                    </p>
                </div>
                <div id="zombieInModal" class="modal-body">
                    Une armée de Zombie...
                </div>
                <div class="modal-footer d-flex justify-content-between">
                    <button class="stopPlaying btn btn-secondary">QUITTER</button>
                    <button class="startPlaying btn btn-secondary">GO POUR LA TUERIE</button>
                </div>
            </div>
        </div>
    </div>

    <div id="gamePauseModal" class="modal">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-body d-flex justify-content-center">PAUSED</div>
            </div>
        </div>
    </div>

    <div id="gameOverModal" class="modal">
        <div class="modal-dialog">
            <div class="modal-content">
                <p class="modal-header d-flex justify-content-center"> GAME OVER </p>
                <div class="modal-body">
                    <div class="grant">
                        <div class="numberOfZombieKilled ">Nombre de Zombie tués : <span id="spanNumberOfZombieKilled"></span></div>
                        <div class="totalScore d-flex justify-content-end">Score Total : <span id="spanScore"></span></div>
                    </div>
                    <div class="endGameZombie"></div>
                </div>
                <div class="modal-footer d-flex justify-content-between">
                    <button class="stopPlaying btn btn-secondary">QUITTER</button>
                    <button class="startPlaying playAgain btn btn-secondary">REJOUER</button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="container d-flex justify-content-center">
        <div class="gameSpace mt-4">
            <div class="statusBar">
                <div class="area1">
                    <div class="GoBackMenu px-1"> <button class="btn btn-outline-secondary GoBackMenuButton"> << </button> </div>
                    <div class="gameName">Zombie Killing</div>
                </div>
                <div class="area2">
                    <div class="pause px-1"><button class="btn btn-outline-primary pauseGame">PAUSE</button></div>
                    <div class="score px-1">Score : <span id="timeScore">0</span></div>
                </div>
            </div>
            <div class="game">
                <div class="senderHoles">
                    <div class="topLeftHole"></div>
                    <div class="topRightHole"></div>
                </div>
                
                <div class="receptionHoles">
                    <div class="tank"></div>
                </div>
                
            </div>
        </div>
    </div>
    <audio id="zombieAttackSound" src="Audios/Group-Of-Zombies-Growling.mp3" loop></audio>
    <audio id="lostSong" src="Audios/lostSong.mp3" loop></audio>
    <audio id="shoutingSong" src="Audios/Gunshot.mp3" loop></audio>

    <script>
        
        $(function(){
            
            let score = 0;
            let numberOfZombieKilled = 0;
            let leftheadCoordinatesTop = "";
            let zombieAttackSound = document.getElementById("zombieAttackSound");
            let lostSong = document.getElementById("lostSong");
            let shoutingSong = document.getElementById("shoutingSong");

            let myModal = new bootstrap.Modal(document.getElementById('myModal'));
            //myModal.show();

            $(".stopPlaying").click(function(){
                $("body").load("bye.html");
            });

            $(".startPlaying").click(function(){
                myModal.hide();

                zombieAttackSound.play();

                let fallingNumber = 0;
                let fallingTime = setInterval(headFalling, 2000);
                //let shoutingTime = setInterval(gunshot, 700);
                //moving();
                //let movingTime = setInterval(moving, 100);
                let getPosition = setInterval(pos, 1000);      

                function headFalling()
                {
                    
                    let randNumber = Math.round(Math.random()*3);
                    randNumber = (randNumber == 0) ? randNumber+1 : randNumber;

                    let leftZombi = document.createElement("img");
                    leftZombi.id = "leftZombi";
                    leftZombi.src = "images/teteZombie"+randNumber+".png";
                    leftZombi.alt = "#";
                    document.querySelector(".topLeftHole").appendChild(leftZombi);
                    $(".topLeftHole img:last").animate({top:"440px",zIndex:"10"},1000).fadeOut(500);
                    
                    
                    setTimeout(function(){
                        let rightZombi = document.createElement("img");
                        rightZombi.id = "rightZombi";
                        rightZombi.src = "images/teteZombie"+randNumber+".png";
                        rightZombi.alt = "#";
                        document.querySelector(".topRightHole").appendChild(rightZombi);
                        $(".topRightHole img:last").animate({top:"440px",zIndex:"10"},1000).fadeOut(500);
                    },1000);


                }
                
                function pos()
                {
                    var leftheadPosition1 =  $(".topLeftHole img:last").offset().top;
                    var leftheadPosition2 =  $(".topLeftHole img:last").offset().left;
                    var leftheadPosition3 =  $(".topLeftHole img:last").outerHeight();
                    var leftheadPosition4 =  $(".topLeftHole img:last").outerWidth();
                    var leftheadPlusHeihgt = leftheadPosition1 + leftheadPosition3;
                    var leftheadPlusWidth = leftheadPosition2 + leftheadPosition4;
                  
                    var rightheadPosition1 =  $(".topRightHole img:last").offset().top;
                    var rightheadPosition2 =  $(".topRightHole img:last").offset().left;
                    var rightheadPosition3 =  $(".topRightHole img:last").outerHeight();
                    var rightheadPosition4 =  $(".topRightHole img:last").outerWidth();
                    var rightheadPlusHeihgt = rightheadPosition1 + rightheadPosition3;
                    var rightheadPlusWidth = rightheadPosition2 + rightheadPosition4;

                    var receptionHolesPosition1 =  $(".receptionHoles").offset().top;
                    var receptionHolesPosition2 =  $(".receptionHoles").offset().left;
                    var receptionHolesPosition3 =  $(".receptionHoles").outerHeight();
                    var receptionHolesPosition4 =  $(".receptionHoles").outerWidth();
                    var receptionHolesPlusHeihgt = receptionHolesPosition1 + receptionHolesPosition3;
                    var receptionHolesPlusWidth = receptionHolesPosition2 + receptionHolesPosition4;
                  
                    if(!(leftheadPlusHeihgt < receptionHolesPosition1 && leftheadPosition1 > receptionHolesPlusHeihgt
                    && leftheadPosition2 > receptionHolesPlusWidth && leftheadPlusWidth < receptionHolesPosition2)) 
                    {   
                        fallingNumber += 1; 
                                  
                        setTimeout(function(){
                            $("body").css("background-color","red")
                        },100);
                        setTimeout(function(){
                            $("body").css("background-color","white")
                        },200);
                        if(fallingNumber === 10)
                        {
                            zombieAttackSound.pause();
                            shoutingSong.pause();
                            clearInterval(shoutingTime);
                            clearInterval(fallingTime);
                            clearInterval(getPosition);
                            let gameOverModal = new bootstrap.Modal(document.getElementById('gameOverModal'));
                            gameOverModal.show();
                            
                            document.getElementById("spanNumberOfZombieKilled").textContent = " " + numberOfZombieKilled;
                            document.getElementById("spanScore").textContent = "  " + score;
                            lostSong.load();
                            lostSong.play();
                            $(".tank > img").remove();
                            $(".playAgain").click(function(){
                                gameOverModal.hide();
                                lostSong.pause();
                            });

                            
                        }
                    }

                    var gunshotPosition1 = $(".tank img:first").offset().top;
                    var gunshotPosition2 = $(".tank img:first").offset().left;
                    var gunshotPosition3 = $(".tank img:first").outerHeight();
                    var gunshotPosition4 = $(".tank img:first").outerWidth();
                    var gunshotPlusHeihgt = gunshotPosition1 + gunshotPosition3;
                    var gunshotPlusWidth = gunshotPosition2 + gunshotPosition4;
                    
                    if(!(leftheadPlusHeihgt < gunshotPosition1 && leftheadPosition1 > gunshotPlusHeihgt
                    && leftheadPosition2 > gunshotPlusWidth && leftheadPlusWidth < gunshotPosition2))
                    {
                        
                        $(".tank img:first").remove();
                        $(".topLeftHole img:last").remove();
                        numberOfZombieKilled += 1;
                        score += 50;
                        document.getElementById("timeScore").textContent = score;
                    }

                         
                }
                
                function gunshot()
                {
                    shoutingSong.play();
                    let gunshot = document.createElement("img");
                    gunshot.id = "gunshot";
                    gunshot.src = "images/balle_de_feu.png";
                    gunshot.alt = "#";
                    document.querySelector(".tank").appendChild(gunshot);
                    $(".tank img:last").animate({bottom:"400px"},1000).fadeOut(500);
                }

                
               /* function moving()
               {
                    
               } */
   
            });
                $(".pauseGame").click(function(){
                    let gamePauseModal = new bootstrap.Modal(document.getElementById("gamePauseModal"));
                    gamePauseModal.show();
                });

                $(document).keydown(function(downkey){
                    let downkeyCode = downkey.which || downkey.keyCode;
                    if(downkeyCode == 37)
                    {
                        let containerLeft =  $(".receptionHoles").offset().left;
                        let containerWidth =  $(".receptionHoles").outerWidth();
                        let containerPlusWidth =  containerLeft + containerWidth;

                        let tankPositionLeft =  $(".tank").offset().left;
                        let tankPositionWidth =  $(".tank").outerWidth();
                        let tankPlusWidth = tankPositionLeft + tankPositionWidth;

                        let answerForcasted = tankPositionLeft - 50 ;
                        
                        document.getElementById("text").innerHTML = tankPositionLeft + " " + containerLeft;
                        if(answerForcasted >= containerLeft)
                        {
                            $(".tank").animate({left:"-=50px"},50);
                        }
                        
                        
                        
                    } 
                
                }); 

                $(document).keydown(function(downkey){
                    let downkeyCode = downkey.which || downkey.keyCode;
                    if(downkeyCode == 39)
                    {
                        let containerLeft =  $(".receptionHoles").offset().left;
                        let containerWidth =  $(".receptionHoles").outerWidth();
                        let containerPlusWidth =  containerLeft + containerWidth;

                        let tankPositionLeft =  $(".tank").offset().left;
                        let tankPositionWidth =  $(".tank").outerWidth();
                        let tankPlusWidth = tankPositionLeft + tankPositionWidth;

                        let answerForcasted = tankPlusWidth + 50 ;
                        
                        if(answerForcasted <= containerPlusWidth)
                        {
                            $(".tank").animate({left:"+=50px"},50);   
                        }
                        
                    }
                    
                }); 
                

                
        });
    </script>
</body>
</html>